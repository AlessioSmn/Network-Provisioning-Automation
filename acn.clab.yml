name: acn-prj

# Avoid having clab prefix on all nodes names (clab-<lab>-<node>)
prefix: __lab-name

mgmt:
  network: custom_mgmt               # management network name
  ipv4-subnet: 10.255.255.0/24       # ipv4 range
  # ipv6-subnet: 3fff:10:255:255::/80  # ipv6 range


topology:

  # List of all nodes
  nodes:

    n1:
      kind: linux
      image: alpine:3.19.1
      binds:
        - ./config/linux-host-cfg.sh:/linux-cfg.sh
      exec:
        - sh /linux-cfg.sh
      env:
        MY_IP: 203.0.113.10/24
        MY_GW: 203.0.113.1

    n2:
      kind: linux
      image: alpine:3.19.1
      binds:
        - ./config/linux-host-cfg.sh:/linux-cfg.sh
      exec:
        - sh /linux-cfg.sh
      env:
        MY_IP: 203.0.114.10/24
        MY_GW: 203.0.114.1

    n3:
      kind: linux
      image: alpine:3.19.1
      binds:
        - ./config/linux-host-cfg.sh:/linux-cfg.sh
      exec:
        - sh /linux-cfg.sh
      env:
        MY_IP: 203.0.114.10/24
        MY_GW: 203.0.114.1

    # Customers

    CE1:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/CE1.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh

    CE2:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/CE2.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh

    # Providers 

    UP1:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/UP1.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh

    UP2:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/UP2.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh

    # Core 

    PE1:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/PE1.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh

    PE2:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/PE2.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh

    GW1:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/GW1.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh

    GW2:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      binds:
        - ./config/startup/GW2.conf:/etc/frr/frr.conf
        - ./config/frr/daemons:/etc/frr/daemons
        - ./config/frr/vtysh.conf:/etc/frr/vtysh.conf
        - ./config/frr/frr-cfg.sh:/frr-cfg.sh
      exec:
        - bash /frr-cfg.sh
  
    # Bridges

    br-clab-core:
      kind: bridge
    br-clab-int:
      kind: bridge

  # List of all links
  links:
    - endpoints: ["n1:eth1", "CE1:eth1"]
    - endpoints: ["n2:eth1", "CE2:eth1"]

    - endpoints: ["PE1:eth2", "CE1:eth2"]
    - endpoints: ["PE1:eth3", "CE2:eth3"]
    - endpoints: ["PE2:eth2", "CE2:eth2"]
    - endpoints: ["PE2:eth3", "CE1:eth3"]

    - endpoints: ["br-clab-core:eth1", "PE1:eth1"]
    - endpoints: ["br-clab-core:eth2", "PE2:eth1"]
    - endpoints: ["br-clab-core:eth3", "GW1:eth1"]
    - endpoints: ["br-clab-core:eth4", "GW2:eth1"]

    - endpoints: ["GW1:eth2", "UP1:eth2"]
    - endpoints: ["GW2:eth2", "UP2:eth2"]

    # Note: using the same interface names as br-clab-core will get error
    - endpoints: ["UP1:eth1", "br-clab-int:eth8"]
    - endpoints: ["UP2:eth1", "br-clab-int:eth9"]
    - endpoints: ["n3:eth1", "br-clab-int:eth10"]
